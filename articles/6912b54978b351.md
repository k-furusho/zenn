---
title: "TanStack Query Ã— TanStack Table è¨­è¨ˆã®åçœç‚¹ã¨æ”¹å–„"
emoji: "ğŸ•Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react","tanstackquery", "tanstack", "tanstacktable","table"]
published: false
---

## ã¯ã˜ã‚ã«
ã“ã‚“ã«ã¡ã¯ã€ãµã‚‹ã—ã‚‡ã†ã§ã™ã€‚
DRESS CODEã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ã€10ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’monorepoæ§‹æˆã®å˜ä¸€ãƒªãƒã‚¸ãƒˆãƒªã§é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚(ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã¯npm packageã¨ã—ã¦åˆ¥ç®¡ç†)
2025å¹´6/10æ™‚ç‚¹ã€å…¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§50å€‹ã®ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã—ã¦ã„ã¦ã€(å¤šã„w)
ãã®ã†ã¡48å€‹ãŒTanstack Tableãƒ™ãƒ¼ã‚¹ã®å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ(DataTable)ã‚’åˆ©ç”¨ã—ã¦DRESS CODEã‚·ãƒªãƒ¼ã‚ºå…¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®UI/UXã‚’çµ±ä¸€ã—ã¦ã„ã¾ã™ã€‚

å…ˆæ—¥ã€ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã«é–¢ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è²°ã„ã€ã“ã‚Œã‚’æ©Ÿã«æ—¢å­˜ã®è¨­è¨ˆã‚’è¦‹ç›´ã™æ©Ÿä¼šãŒã‚ã‚Šã¾ã—ãŸã€‚
æœ¬è¨˜äº‹ã§ã¯ã€ãã®éç¨‹ã§ç›´é¢ã—ãŸèª²é¡Œã€ç‰¹ã« Tanstack Query ã® `initialData` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«èµ·å› ã™ã‚‹å¾®å¦™ãªUIã®ä¸æ•´åˆã€ãã“ã‹ã‚‰ç¾åœ¨ã®è¨­è¨ˆã«è‡³ã‚‹ã¾ã§ã®å­¦ã³ã‚„æ”¹å–„ç­–ã«ã¤ã„ã¦ã€å…·å¤±æ•—è«‡ã‚‚äº¤ãˆãªãŒã‚‰ã”ç´¹ä»‹ã—ã¾ã™ï¼

ã“ã®è¨˜äº‹ãŒã€Tanstack Query ã¨ Tanstack Table ã‚’æ´»ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«é‹ç”¨ã®ã‚ˆã‚Šè‰¯ã„è¨­è¨ˆã‚’è€ƒãˆã‚‹ä¸€åŠ©ã¨ãªã‚Œã°å¹¸ã„ã§ã™ï¼

## TL;DRï¼ˆè¦ç´„ï¼‰

*   **UXã‚’åˆ¶å¾¡ã™ã‚‹çŠ¶æ…‹ç®¡ç†**: `useQuery`ã®`initialData`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¼•ãèµ·ã“ã™UIã®ä¸æ•´åˆï¼ˆã¡ã‚‰ã¤ãã€æ„å›³ã—ãªã„ç©ºè¡¨ç¤ºï¼‰ã‚’ç‰¹å®šã€‚`isPending`ã¨`data`ã®æœ‰ç„¡ã‹ã‚‰UIã®çŠ¶æ…‹ã‚’å³å¯†ã«å®šç¾©ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯`useTableDisplayState`ã‚’å°å…¥ã—ã€ã“ã®å•é¡Œã‚’è§£æ±º
*   **å®£è¨€çš„ãªUIå®šç¾©**: `Column`ãƒ˜ãƒ«ãƒ‘ãƒ¼ã¨`Cell`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã„ã†æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å°å…¥ã—ã€é–‹ç™ºè€…ã¯ã€Œä½•ã‚’ã€è¡¨ç¤ºã—ãŸã„ã‹ã ã‘ã‚’å®£è¨€ã™ã‚Œã°è‰¯ã„è¨­è¨ˆã‚’æ¡ç”¨ã—ã€UIã®ä¸€è²«æ€§ã‚’æ‹…ä¿
*   **URL-DrivenãªçŠ¶æ…‹**: ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚½ãƒ¼ãƒˆé †ã‚’URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨åŒæœŸã•ã›ã‚‹ã“ã¨ã§ã€ãƒªãƒ­ãƒ¼ãƒ‰è€æ€§ã‚„ãƒªãƒ³ã‚¯å…±æœ‰ã¨ã„ã£ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å‘ä¸Šã€‚

## èª²é¡Œã¨å¯¾ç­–

ã¾ãšã€ç¾çŠ¶ã®è¨­è¨ˆ(èª²é¡Œã«å¯¾ã—ã¦å¯¾ç­–ã—ãŸå¾Œã®è¨­è¨ˆã§ã™)



ã“ã“ã§ã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ±ºå®šã¥ã‘ãŸ2ã¤ã®å¤§ããªèª²é¡Œã¨ã€ãã®è§£æ±ºç­–ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

### èª²é¡Œ1ï¼šå®Œç’§ãªã¯ãšã®çŠ¶æ…‹åˆ†é›¢ãŒå¼•ãèµ·ã“ã—ãŸUXã®ç½ 

Server Stateã‚’ç®¡ç†ã™ã‚‹`useQuery`ã®å®Ÿè£…ã«ãŠã„ã¦ã€è¨­è¨ˆãƒŸã‚¹ã‚’ã—ã¾ã—ãŸã€‚`initialData`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ã€`query.data` ã®å‹ã¯ `TData | undefined` ã‹ã‚‰ `TData` ã«å¤‰æ›´ã•ã‚Œã‚‹ãŸã‚ã€å‘¼ã³å‡ºã—å´ã§undefinedã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æ„è­˜ã—ãªãã¦è‰¯ããªã‚‹ã¨ã€å®‰æ˜“ã«`initialData: []`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã—ã¾ã£ãŸã®ã§ã™ã€‚


**ã€å•é¡Œã®ç™ºç”Ÿã€‘**

`initialData`ã®å­˜åœ¨ã¯ã€TanStack Queryã®å†…éƒ¨çŠ¶æ…‹ã«å¤§ããªå½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚è¨˜è¼‰ãŒã‚ã‚‹é€šã‚Šã€`initialData`ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«æ°¸ç¶šåŒ–ã•ã‚Œã‚‹ãŸã‚ã€ãŸã¨ãˆå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãŒã¾ã å®Ÿè¡Œã•ã‚Œã¦ã„ã¦ã‚‚ã€`isPending`ãƒ•ãƒ©ã‚°ãŒ`true`ã«ãªã‚Šã¾ã›ã‚“ã€‚
> "initialData is persisted to the cache, so it is not recommended to provide placeholder, incomplete, or partial data to this option."
> \- [TanStack Query Docs: Initial Data](https://tanstack.com/query/latest/docs/framework/react/guides/initial-data)

ã‚¯ã‚¨ãƒªã¯å³åº§ã«`status: 'success'`ã¨ãªã‚Šã€`data`ã«ã¯`initialData`ã®ç©ºé…åˆ—ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚ã“ã®æŒ™å‹•ãŒã€Client Stateï¼ˆã²ã„ã¦ã¯UIå…¨ä½“ï¼‰ã«æ‚ªå½±éŸ¿ã‚’åŠã¼ã—ã¾ã—ãŸã€‚

*   **ãƒšãƒ¼ã‚¸ã®åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚**: `isPending`ãŒ`true`ã«ãªã‚‰ãªã„ãŸã‚ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã€å³åº§ã«`data`ï¼ˆç©ºé…åˆ—ï¼‰ã§ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæç”»ã•ã‚Œã‚‹ã€‚ãã®çµæœã€ã€Œãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€ã¨ã„ã†è¡¨ç¤ºãŒä¸€ç¬æ˜ ã‚Šè¾¼ã¿ã€ç”»é¢ãŒ**ã¡ã‚‰ã¤ã**ã€‚
*   **æ¤œç´¢å‰ã®åˆæœŸç”»é¢**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã¾ã ä½•ã‚‚æ“ä½œã—ã¦ã„ãªã„ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€ã€Œæ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã€‚

ã“ã‚Œã¯Server Stateã®ç®¡ç†æ‰‹æ³•ã®èª¤ã‚ŠãŒã€UIã®çŠ¶æ…‹é·ç§»ã‚’æ„å›³é€šã‚Šã«åˆ¶å¾¡ã§ããªãã•ã›ã€çµæœã¨ã—ã¦UXã‚’è‘—ã—ãæãªã£ãŸå…¸å‹ä¾‹ã§ã—ãŸã€‚

**ã€å¯¾ç­–ã€‘ `useTableDisplayState`ã«ã‚ˆã‚‹UIçŠ¶æ…‹ã®å³å¯†ãªå®šç¾©**

ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€ç§ãŸã¡ã¯`initialData`ã®ä½¿ç”¨ã‚’ãã£ã±ã‚Šã¨æ­¢ã‚ã€`data`ãŒ`undefined`ã«ãªã‚Šã†ã‚‹ã“ã¨ã‚’è¨±å®¹ã—ã¾ã—ãŸã€‚ãã®ä¸Šã§ã€UIã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ã‚ˆã‚Šå³å¯†ã«åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ `useTableDisplayState` ã‚’å°å…¥ã—ã¾ã—ãŸã€‚

**`src/apps/app/src/components/DataTable/Table/useTableDisplayState.ts`**
```ts
export const useTableDisplayState = <TData>(
  isPending: boolean,
  data: TData[] | undefined, // dataã¯undefinedã«ãªã‚Šã†ã‚‹
  options?: { isInitialState?: boolean; /* ... */ },
): TableDisplayState => {
  return useMemo(() => {
    // 1. isPendingãŒtrueãªã‚‰ã€å•ç­”ç„¡ç”¨ã§"loading"
    if (isPending) return { state: "loading" };
    
    // 2. isInitialStateãŒtrue (dataãŒundefined)ãªã‚‰"placeholder"
    if (options?.isInitialState) return { state: "placeholder" };

    // 3. ãƒ‡ãƒ¼ã‚¿å–å¾—æ¸ˆã¿ã ãŒ0ä»¶ãªã‚‰"empty"
    if (data.length === 0) return { state: "empty" };

    // 4. ä¸Šè¨˜ä»¥å¤–ãªã‚‰ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºçŠ¶æ…‹
    return { state: "data" };
  }, [isPending, data, options?.isInitialState]);
};
```
ã“ã®ãƒ•ãƒƒã‚¯ã¯ã€**`isPending`ã¨`data`ã®æœ‰ç„¡ã¨ã„ã†ä¿¡é ¼ã§ãã‚‹æƒ…å ±æº**ã‹ã‚‰ã€ã€Œãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã€ã€Œæ¤œç´¢å‰ã€ã€Œçµæœãªã—ã€ã€Œãƒ‡ãƒ¼ã‚¿ã‚ã‚Šã€ã¨ã„ã†UIã®çŠ¶æ…‹ã‚’æ˜ç¢ºã«åŒºåˆ¥ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Server Stateã®æŒ™å‹•ã«UIãŒå¼•ããšã‚‰ã‚Œã‚‹ã“ã¨ãªãã€æ„å›³ã—ãŸé€šã‚Šã®çŠ¶æ…‹é·ç§»ã‚’å®Ÿç¾ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### èª²é¡Œ2ï¼šé–‹ç™ºä½“é¨“ã®èª²é¡Œ - ç¹°ã‚Šè¿”ã•ã‚Œã‚‹ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆ

UXã®å•é¡Œã¯è§£æ±ºã—ã¾ã—ãŸãŒã€æ¬¡ã«é–‹ç™ºåŠ¹ç‡ã®èª²é¡ŒãŒæµ®ä¸Šã—ã¾ã—ãŸã€‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯å›ºã¾ã£ãŸã‚‚ã®ã®ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®Ÿè£…ã™ã‚‹ãŸã³ã«`ColumnDef`ã‚’è©³ç´°ã«è¨˜è¿°ã™ã‚‹ã®ã¯å†—é•·ã§ã™ã€‚ç‰¹ã«ã€é »å‡ºã™ã‚‹ã‚«ãƒ©ãƒ ï¼ˆäººç‰©ã€æ—¥ä»˜ãªã©ï¼‰ã®å®Ÿè£…ãŒé–‹ç™ºè€…ã”ã¨ã«å¾®å¦™ã«ç•°ãªã‚Šã€UIã®ä¸€è²«æ€§ãŒæãªã‚ã‚Œã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã—ãŸã€‚

**ã€å¯¾ç­–ã€‘ `Column`ãƒ˜ãƒ«ãƒ‘ãƒ¼ã¨`Cell`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã‚‹æŠ½è±¡åŒ–**

ã“ã®èª²é¡Œã«å¯¾ã—ã€ç§ãŸã¡ã¯ã€Œå®Ÿè£…ã®è©³ç´°ã€ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã€ã€Œå®£è¨€çš„ãªå®šç¾©ã€ã‚’å¯èƒ½ã«ã™ã‚‹2ã¤ã®æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å°å…¥ã—ã¾ã—ãŸã€‚

1.  **`Column`ãƒ˜ãƒ«ãƒ‘ãƒ¼**: `personColumn(...)`ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼é–¢æ•°ã€‚ã‚«ãƒ©ãƒ ã®æ§‹é€ ï¼ˆIDã€ã‚½ãƒ¼ãƒˆå¯å¦ãªã©ï¼‰ã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’éš è”½ã—ã¾ã™ã€‚
2.  **`Cell`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: `PersonCell`ã®ã‚ˆã†ãªReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚å®Ÿéš›ã®ã‚»ãƒ«ã®è¦‹ãŸç›®ã‚’æ‹…å½“ã—ã¾ã™ã€‚

**`src/apps/app/src/components/DataTable/Columns/personColumn.tsx`**
```tsx
import PersonCell from "../Cells/PersonCell";
// ...

export function personColumn<TData>(
  id: NestedKeys<TData>,
  helperOptions: HelperOptions
): ColumnDef<TData> {
  return {
    accessorKey: id,
    meta: { i18nKey: helperOptions.i18nKey ?? "person" },
    header: DataTableColumnHeader,
    // å®Ÿè£…ã®è©³ç´°ã¯PersonCellã«å§”è­²
    cell: ({ getValue }) => <PersonCell person={getValue()} />,
  };
}
```
ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®Ÿè£…ã™ã‚‹é–‹ç™ºè€…ã¯ã€**`personColumn('user', { i18nKey: 'userName' })`** ã®ã‚ˆã†ã«ã€æ„å‘³ã®ã‚ã‚‹å˜ä½ã§å®£è¨€çš„ã«ã‚«ãƒ©ãƒ ã‚’å®šç¾©ã™ã‚‹ã ã‘ã§ã‚ˆããªã‚Šã¾ã—ãŸã€‚

## ã“ã®è¨­è¨ˆãŒã‚‚ãŸã‚‰ã™æŸ”è»Ÿæ€§ã¨æ‹¡å¼µæ€§

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã€DIï¼ˆä¾å­˜æ€§ã®æ³¨å…¥ï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚Šã€é«˜ã„æŸ”è»Ÿæ€§ã¨æ‹¡å¼µæ€§ã‚’æŒã¡ã¾ã™ã€‚

ä¾‹ãˆã°ã€`DataTable`ã«`onRowClick`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ¸¡ã™ã ã‘ã§ã€è¡Œã‚¯ãƒªãƒƒã‚¯æ™‚ã®æŒ™å‹•ã‚’ãƒšãƒ¼ã‚¸ã”ã¨ã«å®šç¾©ã§ãã¾ã™ã€‚å†…éƒ¨ã®`useTableInteraction`ãƒ•ãƒƒã‚¯ãŒã€ã‚»ãƒ«å†…ã®ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã¨ã„ã£ãŸã‚¤ãƒ™ãƒ³ãƒˆã¨ã®ç«¶åˆã‚’è‡ªå‹•ã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ãã‚Œã¾ã™ã€‚

**`DataTable.stories.tsx`ã‚ˆã‚ŠæŠœç²‹**
```tsx
export const WithRowClick: Story = {
  args: {
    data: sampleUsers,
    displayState: { state: "data" },
    onRowClick: (row) => { // onRowClickã«é–¢æ•°ã‚’æ¸¡ã™
      alert(`${row.name}ã®è¡ŒãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚\nID: ${row.id}`);
    },
  },
};
```

åŒæ§˜ã«ã€`useTableDisplayState`ã«`emptyContent`ã‚’æ¸¡ã›ã°ã€ã€Œãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€ã®è¡¨ç¤ºã‚’ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å·®ã—æ›¿ãˆã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

## ä»Šå¾Œã®å±•æœ›

*   **ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä»®æƒ³åŒ–**: æ•°ç™¾è¡Œã‚’è¶…ãˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†å ´åˆã€[TanStack Virtual](https://tanstack.com/virtual/latest)ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ã§ã€DOMè¦ç´ ã‚’ç”»é¢ã«è¦‹ãˆã¦ã„ã‚‹åˆ†ã ã‘ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’åŠ‡çš„ã«å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
*   **é«˜åº¦ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½**: ç¾åœ¨ã¯URLã‚¯ã‚¨ãƒªãƒ™ãƒ¼ã‚¹ã®å˜ç´”ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ã™ãŒã€å„åˆ—ã«å¯¾ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ã‚„æ—¥ä»˜ç¯„å›²é¸æŠãªã©ã®UIã‚’æä¾›ã—ã€`useReactTable`ã®`onColumnFiltersChange`ã¨é€£æºã•ã›ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒ¼ã‚¿æ“ä½œæ©Ÿèƒ½ã‚’æä¾›ã§ãã¾ã™ã€‚

## ã¾ã¨ã‚

æœ¬è¨˜äº‹ã§ã¯ã€ç§ãŸã¡ã®`DataTable`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã€çŠ¶æ…‹åˆ†é›¢ã¨ã„ã†ç†æƒ³ã‹ã‚‰å‡ºç™ºã—ã€`initialData`ã®ç½ ã¨ã„ã†ç¾å®Ÿçš„ãªèª²é¡Œã«ç›´é¢ã—ã€ãã‚Œã‚’ä¹—ã‚Šè¶Šãˆã‚‹ã“ã¨ã§çœŸã«æˆç†Ÿã—ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã¨è‡³ã£ãŸé“ã®ã‚Šã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚


```mermaid
graph TD
    subgraph "ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå±¤ (ä¾‹: AppPeople.tsx)"
        A[ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ] -- "uses" --> B(useTableãƒ•ãƒƒã‚¯);
        A -- "renders" --> C{DataTable};
        A -- "renders" --> D[DataTablePagination];
    end

    subgraph "ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å±¤ (Hooks)"
        B -- "uses" --> B1(TanStack Query ãƒ•ãƒƒã‚¯<br>ä¾‹: useAppPeopleRows);
        B -- "uses" --> B2(TanStack Table ãƒ•ãƒƒã‚¯<br>useReactTable);
        B -- "uses" --> B3(URLåŒæœŸãƒ•ãƒƒã‚¯<br>usePaginationSearch, useSortingSearch);
        B -- "uses" --> B4(UIçŠ¶æ…‹ç®¡ç†ãƒ•ãƒƒã‚¯<br>useTableDisplayState);
    end

    subgraph "å…±é€šDataTableã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå±¤"
        C -- "uses" --> C1(useTableInteraction);
        C -- "conditionally renders" --> C2(TableStructure);
        C -- "conditionally renders" --> C3(FallbackDisplay);

        C2 -- "uses ColumnDefs from" --> B;
        C2 -- "renders" --> C5(Cellsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ<br>ä¾‹: PersonCell);
    end

    subgraph "ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå±¤"
        B1 -- "manages" --> D1(Server State<br>ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥);
        B2 -- "manages" --> D2(Client State<br>ã‚½ãƒ¼ãƒˆã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã€é¸æŠãªã©);
    end

    B1 -- "isPending, data" --> B4;
    B3 -- "state & updater" --> B2;
    B4 -- "displayState" --> A;
    B2 -- "table instance" --> A;
    C1 -- "scroll/click handlers" --> C2

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#ccf,stroke:#333,stroke-width:2px
    style C fill:#9cf,stroke:#333,stroke-width:2px
```




----

# Geminiå‘ã‘ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ


https://tanstack.com/table/latest/docs/framework/react/examples/query-router-search-params

ã®ã‚ˆã†ã«ã€Tanstack Router, Query , Tableã‚’Search Paramsã‚’æ´»ç”¨ã—ãŸè¨­è¨ˆã§ã‚ã‚‹ã“ã¨ã‚‚å¼·èª¿ã—ãŸã„ã€‚

URL-DrivenãªçŠ¶æ…‹ã¨ã„ã†ã®ã¯é©åˆ‡ãªè¡¨ç¾ã§ã¯ãªã„ã­ã€‚


å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…±æœ‰ã™ã‚‹ã‹ã‚‰ã€ã“ã‚Œã‚‰ã‚’è¸ã¾ãˆã¦æ­£ã—ãå¤–éƒ¨ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒèªè­˜ã§ãã‚‹å†…å®¹ã«æ”¹å–„ã—ã¾ã—ã‚‡ã†ã€‚

```typescript : src/apps/app/src/components/DataTable/Table/DataTable.tsx
import { cn } from "@/lib/cn";
import { defaultNS, useTranslation } from "@/lib/i18n";
import type { Props } from "../types";
import { FallbackDisplay } from "./FallbackDisplay";
import { TableStructure } from "./TableStructure";
import { useTableInteraction } from "./useTableInteraction";

const DEFAULT_SKELETON_ROWS = 10;
const MIN_SKELETON_ROWS = 5;

export default function DataTable<TData>({
  table,
  displayState,
  className,
  rootClassName,
  onRowClick,
  isHoverable,
}: Props<TData>) {
  const { t } = useTranslation(defaultNS, {
    keyPrefix: "component.dataTable",
  });

  // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€ã‚¯ãƒªãƒƒã‚¯ï¼‰ã®ç®¡ç†
  const { containerRef, isScrolling, handleRowClick } = useTableInteraction({
    onRowClick,
  });

  // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¡¨ç¤ºã®å ´åˆ
  if (displayState.state === "placeholder") {
    return (
      <FallbackDisplay
        content={displayState.content}
        defaultMessage={t("placeholder")}
        rootClassName={rootClassName}
      />
    );
  }

  // ç©ºçŠ¶æ…‹è¡¨ç¤ºã®å ´åˆ
  if (displayState.state === "empty") {
    return (
      <FallbackDisplay
        content={displayState.content}
        defaultMessage={t("noResult")}
        rootClassName={rootClassName}
      />
    );
  }

  // ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºæ™‚ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³è¡Œæ•°ã‚’æ±ºå®š
  const skeletonRowCount =
    displayState.state === "loading"
      ? Math.max(
          table.getState().pagination.pageSize || DEFAULT_SKELETON_ROWS,
          MIN_SKELETON_ROWS,
        )
      : 0;

  return (
    <div
      ref={containerRef}
      className={cn(
        "h-full overflow-auto rounded-md bg-background",
        rootClassName,
      )}
    >
      <TableStructure
        table={table}
        className={className}
        isScrolling={isScrolling}
        onRowClick={handleRowClick}
        isHoverable={isHoverable}
        isLoading={displayState.state === "loading"}
        skeletonRowCount={skeletonRowCount}
      />
    </div>
  );
}
```

```typescript : src/apps/app/src/components/DataTable/Table/useTableInteraction.ts
import { useThrottle } from "@/hooks/useThrottle";
import { useEffect, useRef, useState, useCallback } from "react";
import { hasClickableAncestor } from "./clickableElement";

/**
 * ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€ã‚¯ãƒªãƒƒã‚¯)ç®¡ç†ãƒ•ãƒƒã‚¯
 * - ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«çŠ¶æ…‹ã®æ¤œçŸ¥ã¨ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°
 * - è¡Œã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†ã¨ç«¶åˆå›é¿
 * - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ
 */
interface UseTableInteractionOptions<TData> {
  /** è¡Œã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•° */
  onRowClick?: (row: TData) => void;
}

interface UseTableInteractionReturn {
  /** ãƒ†ãƒ¼ãƒ–ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã®å‚ç…§ */
  containerRef: React.RefObject<HTMLDivElement>;
  /** ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«çŠ¶æ…‹ï¼ˆã‚«ãƒ©ãƒ å›ºå®šæ™‚ã®å½±è¡¨ç¤ºç”¨ï¼‰ */
  isScrolling: boolean;
  /** è¡Œã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© */
  handleRowClick: (
    event: React.MouseEvent<HTMLTableRowElement>,
    rowData: any,
  ) => void;
}

export const useTableInteraction = <TData>({
  onRowClick,
}: UseTableInteractionOptions<TData> = {}): UseTableInteractionReturn => {
  const containerRef = useRef<HTMLDivElement>(null);
  const [isScrolling, setIsScrolling] = useState(false);

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«çŠ¶æ…‹ã®æ¤œçŸ¥ï¼ˆã‚«ãƒ©ãƒ å›ºå®šæ™‚ã®å½±è¡¨ç¤ºç”¨ï¼‰
  const handleThrottledScroll = useThrottle(
    useCallback(() => {
      setIsScrolling(!!containerRef.current?.scrollLeft);
    }, []),
    100,
  );

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®šãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  useEffect(() => {
    const container = containerRef.current;
    if (!container) return;

    container.addEventListener("scroll", handleThrottledScroll);
    return () => container.removeEventListener("scroll", handleThrottledScroll);
  }, [handleThrottledScroll]);

  // è¡Œã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†
  const handleRowClick = useCallback(
    (event: React.MouseEvent<HTMLTableRowElement>, rowData: TData) => {
      if (!onRowClick || !(event.target instanceof HTMLElement)) {
        return;
      }

      // ã‚»ãƒ«å†…ã®ã‚¯ãƒªãƒƒã‚«ãƒ–ãƒ«è¦ç´ ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸå ´åˆã¯è¡Œã‚¯ãƒªãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–
      if (hasClickableAncestor(event.target, event.currentTarget)) {
        event.stopPropagation();
        return;
      }

      onRowClick(rowData);
    },
    [onRowClick],
  );

  return {
    containerRef,
    isScrolling,
    handleRowClick,
  };
};
```

```typescript : src/apps/app/src/components/DataTable/Table/useTableDisplayState.ts
import type { ReactNode } from "react";
import { useMemo } from "react";
import type { TableDisplayState } from "../types";

/**
 * DataTableã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
 * - ãƒ‡ãƒ¼ã‚¿ã®çŠ¶æ…‹ã«åŸºã¥ãé©åˆ‡ãªDisplayStateã®æ±ºå®š
 * - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆuseMemoã«ã‚ˆã‚‹å†è¨ˆç®—é˜²æ­¢ï¼‰
 * - å‹å®‰å…¨æ€§ã®ä¿è¨¼
 * @template TData ãƒ‡ãƒ¼ã‚¿é…åˆ—ã®è¦ç´ å‹
 * @param isPending TanStack Queryã®query.isPendingã‚’ä½¿ç”¨
 * @param data è¡¨ç¤ºå¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿é…åˆ—ï¼ˆç©ºé…åˆ—åˆ¤å®šã«ä½¿ç”¨ï¼‰
 * @param options è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³
 * @param options.isInitialState åˆæœŸçŠ¶æ…‹ã‹ã©ã†ã‹ï¼ˆæ¤œç´¢å‰ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æœªé©ç”¨ãªã©ï¼‰
 * @param options.emptyContent ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®å ´åˆã«è¡¨ç¤ºã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
 * @param options.placeholderContent ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼çŠ¶æ…‹ã§è¡¨ç¤ºã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
 * @returns ãƒ¡ãƒ¢åŒ–ã•ã‚ŒãŸTableDisplayState ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 *
 * ## ä½¿ç”¨ä¾‹
 * ```typescript
 * const ProductPermissionsPage = () => {
 *   const { data, isPending } = useGetProductPermissions();
 *   const displayState = useTableDisplayState(
 *     isPending,
 *     data?.items ?? [],
 *     {
 *       isInitialState: !data, // ãƒ‡ãƒ¼ã‚¿ãŒä¸€åº¦ã‚‚å–å¾—ã•ã‚Œã¦ã„ãªã„å ´åˆ
 *       emptyContent: <CustomEmptyMessage />,
 *       placeholderContent: <SearchPromptMessage />
 *     }
 *   );
 *
 *   return <DataTable table={table} displayState={displayState} />;
 * };
 *
 * ## çŠ¶æ…‹ã®å„ªå…ˆé †ä½
 * 1. `loading`: isPendingãŒtrueã®å ´åˆï¼ˆæœ€å„ªå…ˆï¼‰
 * 2. `placeholder`: isInitialStateãŒtrueã‹ã¤isPendingãŒfalseã®å ´åˆ
 * 3. `empty`: ãƒ‡ãƒ¼ã‚¿ãŒç©ºé…åˆ—ã‹ã¤åˆæœŸçŠ¶æ…‹ã§ã¯ãªã„å ´åˆ
 * 4. `data`: é€šå¸¸ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºçŠ¶æ…‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
 *
 * ## placeholderçŠ¶æ…‹ã®ä½¿ç”¨æƒ³å®š
 * - æ¤œç´¢ã‚¯ã‚¨ãƒªãŒå…¥åŠ›ã•ã‚Œã¦ã„ãªã„åˆæœŸçŠ¶æ…‹
 * - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹
 * - ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãŒä¸€åº¦ã‚‚å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹
 * - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿ƒã—ãŸã„å ´åˆ
 */
export const useTableDisplayState = <TData>(
  isPending: boolean,
  data: TData[],
  options?: {
    /** åˆæœŸçŠ¶æ…‹ã‹ã©ã†ã‹ï¼ˆæ¤œç´¢å‰ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æœªé©ç”¨ãªã©ï¼‰ */
    isInitialState?: boolean;
    /** ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®å ´åˆã«è¡¨ç¤ºã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    emptyContent?: ReactNode;
    /** ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼çŠ¶æ…‹ã§è¡¨ç¤ºã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    placeholderContent?: ReactNode;
  },
): TableDisplayState => {
  return useMemo(() => {
    // 1. èª­ã¿è¾¼ã¿ä¸­ã®çŠ¶æ…‹ã‚’æœ€å„ªå…ˆã§å‡¦ç†
    if (isPending) {
      return { state: "loading" } as const;
    }

    // 2. åˆæœŸçŠ¶æ…‹ï¼ˆæ¤œç´¢å‰ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æœªé©ç”¨ãªã©ï¼‰ã®å‡¦ç†
    if (options?.isInitialState) {
      return {
        state: "placeholder",
        content: options.placeholderContent,
      } as const;
    }

    // 3. ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®å ´åˆã®å‡¦ç†ï¼ˆåˆæœŸçŠ¶æ…‹ã§ã¯ãªã„å ´åˆï¼‰
    if (data.length === 0) {
      return {
        state: "empty",
        content: options?.emptyContent,
      } as const;
    }

    // 4. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šé€šå¸¸ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºçŠ¶æ…‹
    return { state: "data" } as const;
  }, [
    isPending,
    data.length,
    options?.isInitialState,
    options?.emptyContent,
    options?.placeholderContent,
  ]);
};
```

```typescript : src/apps/app/src/components/DataTable/types.ts
import type { Table as TableType } from "@tanstack/react-table";
import type { Property } from "csstype";
import type { defaultNS, KeyPrefix, ParseKeys, TOptions } from "@/lib/i18n";
import type { ReactNode } from "react";

/**
 * DataTableã®è¡¨ç¤ºçŠ¶æ…‹
 */
export type TableDisplayState =
  | {
      /** ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ - ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡¨ç¤º */
      readonly state: "loading";
    }
  | {
      /** åˆæœŸçŠ¶æ…‹/æ¤œç´¢å‰ - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º */
      readonly state: "placeholder";
      /** ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¡¨ç¤ºå†…å®¹ï¼ˆæœªæŒ‡å®šæ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ */
      readonly content?: ReactNode;
    }
  | {
      /** ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºä¸­ - é€šå¸¸ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º */
      readonly state: "data";
    }
  | {
      /** ãƒ‡ãƒ¼ã‚¿ãŒç©º - ç©ºçŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º */
      readonly state: "empty";
      /** ç©ºçŠ¶æ…‹è¡¨ç¤ºå†…å®¹ï¼ˆæœªæŒ‡å®šæ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ */
      readonly content?: ReactNode;
    };

/**
 * DataTableã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å®šç¾©
 *
 * TanStack Tableã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å—ã‘å–ã‚Šã€UIã‚’æç”»ã™ã‚‹ãŸã‚ã®è¨­å®šã‚’æä¾›ã—ã¾ã™ã€‚
 */
export type Props<TData> = {
  /** TanStack Tableã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆuseReactTableã§ä½œæˆï¼‰ */
  table: TableType<TData>;
  /** ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡¨ç¤ºçŠ¶æ…‹ */
  displayState: TableDisplayState;
  /** ãƒ†ãƒ¼ãƒ–ãƒ«è¦ç´ ã«é©ç”¨ã™ã‚‹CSSã‚¯ãƒ©ã‚¹ */
  className?: string;
  /** ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠè¦ç´ ã«é©ç”¨ã™ã‚‹CSSã‚¯ãƒ©ã‚¹ */
  rootClassName?: string;
  /** è¡Œã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ï¼ˆè¡Œãƒ‡ãƒ¼ã‚¿ãŒå¼•æ•°ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹ï¼‰ */
  onRowClick?: (row: TData) => void;
  /** ã‚¯ãƒªãƒƒã‚¯æ™‚ã« Hover / Cursor Pointer ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ */
  isHoverable?: boolean;
};

/**
 * i18nç¿»è¨³ã‚­ãƒ¼ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹å®šç¾©
 * ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®ç¿»è¨³ã‚­ãƒ¼ã¯"component.dataTable.headers"ä»¥ä¸‹ã«é…ç½®ã—ã¦ã„ã‚‹
 */
const headerKeyPrefix = "component.dataTable.headers" satisfies KeyPrefix<
  typeof defaultNS
>;

/**
 * ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®i18nã‚­ãƒ¼ã®å‹å®šç¾©
 */
export type TableHeaderI18nKey = ParseKeys<
  typeof defaultNS,
  TOptions,
  typeof headerKeyPrefix
>;

/**
 * ã‚«ãƒ©ãƒ å®šç¾©ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã§ä½¿ç”¨ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³
 *
 * DataTableã®å„ç¨®ã‚«ãƒ©ãƒ ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆsimpleTextColumn, simpleDateColumnãªã©ï¼‰ã§
 * å…±é€šã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
 */
export type HelperOptions = {
  /** ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®i18nã‚­ãƒ¼ï¼ˆç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã•ã‚ŒãŸã‚­ãƒ¼ã‚’æŒ‡å®šï¼‰ */
  i18nKey?: TableHeaderI18nKey;
  /** ãƒ†ãƒ¼ãƒ–ãƒ«åˆ—ã®æœ€å°å¹…ï¼ˆCSSå˜ä½æ–‡å­—åˆ—ã§æŒ‡å®šã€ä¾‹: "200px", "10rem"ï¼‰ */
  minWidth?: Property.MinWidth;
  /** ãƒ†ãƒ¼ãƒ–ãƒ«åˆ—ã®æœ€å¤§å¹…ï¼ˆCSSå˜ä½æ–‡å­—åˆ—ã§æŒ‡å®šã€ä¾‹: "300px", "20rem"ï¼‰ */
  maxWidth?: Property.MaxWidth;
  /** ãƒ†ãƒ¼ãƒ–ãƒ«åˆ—ã®ã‚½ãƒ¼ãƒˆå¯å¦ï¼ˆtrueã®å ´åˆã€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã§ã‚½ãƒ¼ãƒˆå¯èƒ½ï¼‰ */
  sortable?: boolean;
};
```

```typescript : src/apps/app/src/components/DataTable/Table/TableStructure.tsx
import { cn } from "@/lib/cn";
import { type Table as TableType, flexRender } from "@tanstack/react-table";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "../../ui/table";
import { SkeletonRow } from "./SkeletonRow";
import { getColumnPinningClassNames } from "./getColumnPinningClassNames";

/**
 * ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 *ã€€ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ§‹é€ çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã€ãƒ‡ãƒ¼ã‚¿è¡Œã€ã‚¹ã‚±ãƒ«ãƒˆãƒ³è¡Œï¼‰ã«é–¢ã™ã‚‹è²¬ä»»ã‚’æŒã¤
 */
interface TableStructureProps<TData> {
  /** TanStack Tableã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ */
  table: TableType<TData>;
  /** ãƒ†ãƒ¼ãƒ–ãƒ«è¦ç´ ã®CSSã‚¯ãƒ©ã‚¹ */
  className?: string;
  /** ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«çŠ¶æ…‹ */
  isScrolling: boolean;
  /** è¡Œã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© */
  onRowClick: (
    event: React.MouseEvent<HTMLTableRowElement>,
    rowData: TData,
  ) => void;
  /** ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‹ã©ã†ã‹ */
  isLoading?: boolean;
  /** ã‚¹ã‚±ãƒ«ãƒˆãƒ³è¡Œæ•° */
  skeletonRowCount?: number;
  /** ã‚¯ãƒªãƒƒã‚¯æ™‚ã« Hover / Cursor Pointer ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ */
  isHoverable?: boolean;
}

export function TableStructure<TData>({
  table,
  className,
  isScrolling,
  onRowClick,
  isLoading = false,
  skeletonRowCount = 0,
  isHoverable = true,
}: TableStructureProps<TData>) {
  return (
    <Table className={cn("w-full", className)}>
      {/* ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã‚‚å¸¸ã«è¡¨ç¤ºï¼‰ */}
      <TableHeader className="sticky top-0 z-20 shadow-sm bg-background">
        {table.getHeaderGroups().map((headerGroup) => (
          <TableRow key={headerGroup.id}>
            {headerGroup.headers.map((header) => (
              <TableHead
                key={header.id}
                colSpan={header.colSpan}
                style={header.column.columnDef.meta?.thStyle}
                className={getColumnPinningClassNames(
                  header.column,
                  isScrolling,
                )}
                role="columnheader"
                aria-sort={
                  header.column.getIsSorted() === "asc"
                    ? "ascending"
                    : header.column.getIsSorted() === "desc"
                      ? "descending"
                      : undefined
                }
              >
                {!header.isPlaceholder &&
                  flexRender(
                    header.column.columnDef.header,
                    header.getContext(),
                  )}
              </TableHead>
            ))}
          </TableRow>
        ))}
      </TableHeader>

      <TableBody>
        {/* ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º */}
        {isLoading
          ? Array.from({ length: skeletonRowCount }, (_, index) => (
              <SkeletonRow
                key={`skeleton-row-${index}`}
                table={table}
                rowIndex={index}
                isScrolling={isScrolling}
              />
            ))
          : /* é€šå¸¸ã®ãƒ‡ãƒ¼ã‚¿è¡Œã‚’è¡¨ç¤º */
            table
              .getRowModel()
              .rows.map((row) => (
                <TableRow
                  key={row.id}
                  data-state={row.getIsSelected() ? "selected" : undefined}
                  role="row"
                  className={cn(
                    isHoverable && "cursor-pointer hover:bg-muted",
                    table.options.meta?.getRowClassName?.(row),
                  )}
                  onClick={(event) => onRowClick(event, row.original)}
                  tabIndex={0}
                  onKeyDown={(e) => {
                    if (e.key === "Enter" || e.key === " ") {
                      e.preventDefault();
                      onRowClick(e as any, row.original);
                    }
                  }}
                >
                  {row.getVisibleCells().map((cell) => (
                    <TableCell
                      key={cell.id}
                      className={cn(
                        "first:pl-6",
                        getColumnPinningClassNames(cell.column, isScrolling),
                        isHoverable && "cursor-pointer",
                        table.options.meta?.getRowClassName?.(row),
                      )}
                      style={cell.column.columnDef.meta?.tdStyle}
                      role="cell"
                    >
                      {flexRender(
                        cell.column.columnDef.cell,
                        cell.getContext(),
                      )}
                    </TableCell>
                  ))}
                </TableRow>
              ))}
      </TableBody>
    </Table>
  );
}
```

```typescript : src/apps/app/src/routes/_staff/apps/_list/people/index.lazy.tsx
import ActionButton from "@/components/Button/ActionButton";
import {
  createFilterDefHelper,
  useComposableFilter,
} from "@/components/ComposableFilter";
import {
  IntegratedAppFilterChip,
  PlaceFilterChip,
} from "@/components/FilterChip";
import { HStack } from "@/components/Layout";
import FillScreen from "@/components/Layout/FillScreen";
import SearchInput from "@/components/SearchInput";
import { useDebouncedCallback } from "@/hooks/useDebouncedCallback";
import { defaultNS, useTranslation } from "@/lib/i18n";
import { createLazyFileRoute, useNavigate } from "@tanstack/react-router";
import { isFunction } from "lodash-es";
import type { ChangeEvent } from "react";
import { useCallback } from "react";
import { AppPeopleTable } from "./-components/AppPeople";
import { WorkForceMegaMenu } from "./-components/WorkForceMegaMenu";
import { useAppPeopleExport } from "./-query";
import type { AppPeopleFilter } from "./-types";

export const Route = createLazyFileRoute("/_staff/apps/_list/people/")({
  component: People,
});

const helper = createFilterDefHelper<AppPeopleFilter>();
const filterDefs = [
  helper("appIntegrationIds", { component: IntegratedAppFilterChip }),
  // helper("workerTypeIds", { component: WorkerTypeFilterChip }),
  helper("placeIds", { component: PlaceFilterChip }),
];

function People() {
  const { t } = useTranslation(defaultNS, { keyPrefix: "pages.apps.people" });
  const { t: tCommon } = useTranslation(defaultNS, {
    keyPrefix: "common",
  });
  const navigate = useNavigate({ from: "/apps/people" });
  const search = Route.useSearch();
  const { mutate: exportAppUsersCsv, isPending } = useAppPeopleExport({
    freeText: search.freeText,
    appIntegrationIdIn: search.appIntegrationIds,
    placeIdIn: search.placeIds,
    category: search.category,
  });
  const filter = useComposableFilter<AppPeopleFilter>({
    filterDefs,
    filterState: search,
    onFilterStateChange: useCallback(
      (state) =>
        navigate({
          search: (prev) => ({
            ...prev,
            ...(isFunction(state) ? state(prev) : state),
          }),
        }),
      [navigate],
    ),
  });

  const handleFilterInput = useDebouncedCallback(
    (e: ChangeEvent<HTMLInputElement>) =>
      navigate({
        search: (prev) => ({
          ...prev,
          freeText: e.target.value,
          pageIndex: 0,
        }),
      }),
    [navigate],
  );

  return (
    <FillScreen className="flex flex-col gap-4 px-12 py-5">
      <HStack className="gap-2 items-center">
        <WorkForceMegaMenu />
      </HStack>
      <HStack className="justify-between items-center p-2 rounded bg-background">
        <HStack className="gap-2">
          <SearchInput
            className="h-8 w-interaction-box-sm"
            placeholder={t("filterPeoplePlaceholder")}
            defaultValue={search.freeText}
            onChange={handleFilterInput}
          />
          {filter.getAllFilterDefs().map(({ component: Component, ...def }) => (
            <Component
              key={def.id}
              value={filter.filterState[def.id]}
              onChange={filter.getOnChangeHandler(def.id)}
            />
          ))}
        </HStack>
        <ActionButton
          icon="Download"
          variant="ghost"
          iconColor="primary"
          onClick={() => exportAppUsersCsv()}
          isLoading={isPending}
        >
          {tCommon("action.export")}
        </ActionButton>
      </HStack>
      <AppPeopleTable />
    </FillScreen>
  );
}
```

```typescript : src/apps/app/src/routes/_staff/apps/_list/people/-components/AppPeople.tsx
import { DataTable, DataTablePagination } from "@/components/DataTable";
import useDocumentTitle from "@/hooks/useDocumentTitle";
import { defaultNS, useTranslation } from "@/lib/i18n";
import { useTable } from "../-hooks/useTable";

export function AppPeopleTable() {
  const { t } = useTranslation(defaultNS, { keyPrefix: "pages.apps.people" });
  useDocumentTitle(t("pageTitle"));

  const { table, displayState } = useTable();

  return (
    <>
      <DataTable table={table} displayState={displayState} />
      <DataTablePagination table={table} />
    </>
  );
}
```

```typescript : src/apps/app/src/routes/_staff/apps/_list/people/-hooks/useTable.tsx
import { usePaginationSearch, useSortingSearch } from "@/lib/listPage";
import { Route } from "..";
import { useAppPeopleRows } from "../-query";
import {
  ColumnsToSortColumns,
  type ORDER_BY_FILTER,
  type SORTABLE_COLUMNS,
  SortColumnsToColumns,
} from "../-constants";
import {
  getCoreRowModel,
  getFacetedRowModel,
  getFacetedUniqueValues,
  getFilteredRowModel,
  getPaginationRowModel,
  getSortedRowModel,
  useReactTable,
} from "@tanstack/react-table";
import { useAppPeopleColumns } from "../-components/columns";
import { useNavigate } from "@tanstack/react-router";
import { useTableDisplayState } from "@/components/DataTable";

export const useTable = () => {
  const search = Route.useSearch();
  const navigate = useNavigate({ from: "/apps/people" });
  const { data, isPending } = useAppPeopleRows(search);

  const [pagination, setPagination] = usePaginationSearch({
    search,
    onSearchChange: (search) => navigate({ search }),
  });
  const [sorting, setSorting] = useSortingSearch({
    search,
    onSearchChange: (search) =>
      navigate({
        search: {
          ...search,
          // NOTE: columnã®idãŒã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã€sortColumnã¯å¤§æ–‡å­—ã«ãªã£ã¦ã„ã‚‹ã®ã§å¤‰æ›
          sortColumn:
            ColumnsToSortColumns[search.sortColumn as SORTABLE_COLUMNS],
        },
      }),
    convertSortColumn: (sortColumn) =>
      // NOTE: columnã®idãŒã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã€sortColumnã¯å¤§æ–‡å­—ã«ãªã£ã¦ã„ã‚‹ã®ã§å¤‰æ›
      SortColumnsToColumns[sortColumn as ORDER_BY_FILTER],
  });

  const columns = useAppPeopleColumns();

  const table = useReactTable({
    data: data?.data ?? [],
    pageCount: data?.maxPage,
    columns,
    initialState: {
      columnPinning: { left: ["person"], right: ["actions"] },
    },
    state: { pagination, sorting },
    getCoreRowModel: getCoreRowModel(),
    getFilteredRowModel: getFilteredRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    getSortedRowModel: getSortedRowModel(),
    getFacetedRowModel: getFacetedRowModel(),
    getFacetedUniqueValues: getFacetedUniqueValues(),
    onPaginationChange: setPagination,
    onSortingChange: setSorting,
    manualPagination: true,
    manualSorting: true,
  });

  const displayState = useTableDisplayState(isPending, data?.data ?? []);

  return { table, displayState };
};
```


```typescript : src/apps/app/src/routes/_staff/apps/_list/people/-query/index.ts
import { useMutation, useQuery } from "@tanstack/react-query";
import { convertToAppPeopleTableRows } from "../-adapter";
import type { SearchSchema } from "../-schemas";
import { getAppPeople, getAppPeopleCount, getAppPeopleExport } from "./api";
import type { AppPeopleExportQuery, AppPeopleExportRes } from "./type";
import { downloadFile } from "@/lib/api/utils";

export const useAppPeopleRows = (search: SearchSchema) => {
  return useQuery({
    queryKey: ["appPeople", search],
    queryFn: () =>
      getAppPeople({
        query: {
          freeText: search.freeText,
          appIntegrationIdIn: search.appIntegrationIds,
          contractTypeIn: search.contractTypeIds,
          placeIdIn: search.placeIds,
          page: search.pageIndex + 1,
          pageSize: search.pageSize,
          category: search.category,
          orderBy: search.sortColumn,
          orderDirection: search.sortOrder,
        },
      }),
    select: (data) => ({
      data: convertToAppPeopleTableRows(data),
      page: data.page,
      maxPage: data.maxPage,
    }),
  });
};

export const useAppPeopleExport = (query: AppPeopleExportQuery) => {
  return useMutation({
    mutationKey: ["appPeopleExport", query],
    mutationFn: () => getAppPeopleExport({ query }),
    onSuccess: async (data) => {
      const csvData = data as AppPeopleExportRes;
      if (csvData?.url && csvData?.mode) {
        const filename = `app-people-export-${new Date().toISOString().split("T")[0]}.csv`;
        await downloadFile(csvData.url, filename);
      }
    },
  });
};

export const useAppPeopleCount = () => {
  return useQuery({
    queryKey: ["appPeopleCount"],
    queryFn: () => getAppPeopleCount(),
  });
};
```